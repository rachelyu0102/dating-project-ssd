@model WebApplication9.ViewModels.ClientDetailInfo

@{
    ViewBag.Title = "UserProfile";
}

@{
    var date = DateTime.Now.Date.Subtract((DateTime)Model.client.birthdate);
    int year = (int)date.TotalDays / 365;

} 

<div class="col-md-12 profile" style="position:relative">
    <div class="profileHeaderImg col-md-12 w3-card-2">
        
       
        <img src="~/Images/profileDefaultBg1.jpg"  style="width:100%"/>
        <div class="w3-container w3-padding-24">


        </div>

    </div>

  
    <div style="height:200px; width:200px; position:absolute; top: 250px;
    left: 64px;">

        @if (Model.client.profile != null)
        {
            <img class="img-thumbnail" src="~/Images/Uploads/UserProfile/@Model.client.profile" alt="@Model.client.UserName" style="width:100%;height:100%" />

        }
        else if (Model.client.gender == "male")
        {
            <img class="img-thumbnail" src="~/Images/Uploads/UserProfile/default-profile-male.jpg" alt="@Model.client.UserName" style="width:100%;height:100%" />
        
        }
        else
        {
            <img class="img-thumbnail" src="~/Images/Uploads/UserProfile/default-profile-female.jpg" alt="@Model.client.UserName" style="width:100%;height:100%" />
      
        }
    </div>
    

    </div>
<div class="col-md-3 w3-margin-64 w3-border w3-round" style="width:200px;">

    <div><a href="~/home/testOnline/?username=@Model.client.UserName">
    <span class="userName w3-justify" style="text-align:center">

        @Model.client.UserName
    </span></a>
</div>
   
    <div id="userLoginState">
        @if (Session[Model.client.UserName] != null)
        {
            if (Session[Model.client.UserName].ToString() == "true")
            {
                <p><img src="~/Images/3d-green-ball-th.png "style="max-width:10px; max-height:10px;"/> Online</p>
            }
            

        }
        else
        {
            <p><img src="~/Images/3d-red-ball.png" style="max-width:10px; max-height:10px;"/> Offline</p>
        }
    </div>

    @*<div>@Model.client.email</div>*@
    <div style="margin-top:16px">@Model.client.gender, @year</div>
    <div style="margin-top:5px"> @Model.client.province, @Model.client.country</div>
    <div style="margin-top:5px">
        <span >Like: </span>
        @if (Model.interests != null)
        {
            int length = (Model.interests).Count();
            int counter = 0;
            foreach (var interest in Model.interests)
            {
                counter++;
                if (interest != null)
                {
                    if (counter < length)
                    {
                        <span>@interest,</span>
                    }
                    else
                    {
                        <span>@interest</span>
                    }

                }

               
            }
        }
</div>
    <div class="w3-margin w3-left">@if(Request.IsAuthenticated && User.Identity.Name==Model.client.UserName) {
        <a href="#" class="btn btn-info btn-sm " data-toggle="modal" data-target="#updateFormModal">Update</a>
    }</div>


    
</div>
@if (ViewBag.uploadPhotoError != null)
{
    <div class="alert  alert-info alert-dismissible col-md-6 col-md-offset-3" role="alert" style="margin-top:20px!important;margin-left: 0px!important;">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="message-inside">
            <span>@ViewBag.uploadPhotoError</span>
        </div>
    </div>
}




<div class="modal fade w3-padding w3-padding" tabindex="-1" role="dialog" id="updateFormModal" style="margin:20px!important" ng-app="">
        <div class="modal-dialog modal-lg">
            <div class="modal-content w3-margin w3-padding">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Upload images</h4>
                </div>
                <div class="modal-body">
                    <form action="~/Home/UserProfile" method="post" enctype="multipart/form-data" class="form-horizontal">
                        <div class="form-group">
                            <input type="text" name="client.UserName" value="@Model.client.UserName" class="form-control" readonly>
                        </div>                                   

                        <div class="form-group">
                            <label for="Gender">Gender:</label><br />
                            @if (Model.client.gender == "male")
        {
                                <label class="radio-inline"><input type="radio" name="client.gender" value="male" checked>Male</label>
                                <label class="radio-inline"><input type="radio" name="client.gender" value="female">Female</label><br />
                            }
                            else
                            {
                                <label class="radio-inline"><input type="radio" name="client.gender" value="male">Male</label>
                                    <label class="radio-inline"><input type="radio" name="client.gender" value="female" checked>Female</label><br />

                            }

                        </div>

                        <div class="form-group">
                            <label for="photo">Photo:</label>
                            <input type="file" name="photo" class="form-control" id="photo"/>
                        </div>

                        <div class="form-group">
                           <label for="birthDay"></label>
                            <input type="date" name="client.birthdate" class="form-control"/>
                        </div>

                        <div class="form-group">
                            <label for="Location">Location:</label><br />
                            <select name="country" class="countries" id="countryId">
                                <option value="">Select Country</option>
                            </select>
                            <select name="state" class="states" id="stateId">
                                <option value="">Select State</option>
                            </select>
                            @*<select name="city" class="cities" id="cityId">
                                <option value="">Select City</option>
                            </select>*@
                        </div>

                        <div class="form-group">
                            <label for="interests">Interests (hold shift to select more than one，you can select 3 interests):</label>
                            <select multiple class="form-control" id="interests" name="interests[]">                             
                                @{ 
                                    var counter1 = 0;
                                }
                                @foreach (var interest in ViewBag.interests)
                                {
                                    <option name ="interests[@counter1]"value="@interest.interest1">@interest.interest1</option>
                                    counter1++;
                                }
                            </select>
                        </div>                   

                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <input type="submit" class="btn btn-primary" value="Upload">
                    </form>

                </div>
                <div class="modal-footer">
                   
                </div>
            </div>
        </div>
    </div>

<div class="modal fade w3-padding w3-padding" tabindex="-1" role="dialog" id="messageModal" style="margin:20px!important" ng-app="">
    <div class="modal-dialog modal-lg">
        <div class="modal-content w3-margin w3-padding">
            <div class="modal-header">
                <h4 class="modal-title">Message</h4>
            </div>
            <textarea class="field span12 form-control" rows="12">

            </textarea>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Send</button>
            </div>
        </div>
    </div>
</div>





<!--<div class="w3-margin w3-left">

    <a href="#" class="btn btn-info btn-sm " data-toggle="modal" data-target="#updateFormModal">Update</a>

</div>
-->
<div id="message" style="position:fixed; top:700px; left: 120px;">
    @if (Request.IsAuthenticated && User.Identity.Name != Model.client.UserName)
    {
        <a href="#" class="btn btn-info btn-sm " data-toggle="modal" data-target="#messageModal">Message</a>
    }
</div>

@using (Html.BeginForm("FileUpload", "Home", FormMethod.Post,
                                        new { enctype = "multipart/form-data" }))
{
    <label for="file">Upload Image:</label>
    <input type="file" name="file" id="file" style="width: 100%;" />
    <input type="text" name="username" value="@User.Identity.Name" hidden/>
    <input type="submit" value="Upload" class="submit" />
}

<!--
<div id="imageUpload">
    @if (Request.IsAuthenticated && User.Identity.Name == Model.client.UserName)
    {
        <a href="#" class="btn btn-info btn-sm" data-toggle="modal" data-target="#imageModal">Upload images</a>
        
    }
    

</div>

<div class="modal fade w3-padding w3-padding" tabindex="-1" role="dialog" id="imageModal" style="margin:20px!important" ng-app="">
    <div class="modal-dialog modal-lg">
        <div class="modal-content w3-margin w3-padding">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Upload images</h4>
            </div>
            <div class="modal-body">
                <form action="~/Home/UserProfile" method="post" enctype="multipart/form-data" class="form-horizontal">

                    <div class="form-group">
                        <label for="photo">Photo:</label>
                        <input type="file" name="photo" class="form-control" id="photo" />
                        <input type="submit" class="btn btn-primary" value="Upload">
                    </div>          

            
                </form>

            </div>

        </div>
    </div>
</div>
-->






@if (!User.IsInRole("PaidUser"))
{
<div id="upgradeFooter">
    <p><a class="btn btn-info btn-sm" style="float:right; margin-right:10px; top:465px; right:0; position:absolute;" href="~/Home/Upgrade">Upgrade</a></p>
</div>
}

<!---->
<div id="alertArea"></div>

@if (User.Identity.Name != Model.client.UserName)
{
    <a class="btn btn-default start_a_conversation" href="/home/StartAConversation?receiver=@Model.client.UserName&&sender=@User.Identity.Name">Start 
    a conversation</a>
    <input id="sendTo" value="@Model.client.UserName" style="display:none"><br />
    <input id="sendFrom" value="@User.Identity.Name" style="display:none" /><br />

}

 <script>
     $(document).ready(function () {
         $("#myBtn").click(function () {
         $("#myModal").modal();
    });
});
</script>

<script src="http://lab.iamrohit.in/js/location.js"></script>

<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
<script src="~/signalr/hubs"></script>
<script>

    
     $(function () {
         var chatStart = $.connection.chatHub;

         $.connection.hub.start().done(function () {
            $('.start_a_conversation').click(function (event) {
                event.preventDefault();
                window.open($(this).attr("href"), 'startAConversation', "width=600,height=600,scrollbars=yes");
               var start_receiver = $("#sendTo").val();
               var start_sender = $("#sendFrom").val();
               console.log(start_receiver);
               console.log(start_sender);
               chatStart.server.startAConversation(start_receiver, start_sender);
               console.log("test");
            });
            });
        });
</script>
